# Microsoft.LinuxTracepoints.Provider

.NET library for logging Linux user_events Tracepoints with EventHeader encoding.

Requires TargetFramework `net6.0` or later.

See [ProviderSample](../ProviderSample/README.md) for example usage.

## Usage

- At component initialization, create
  `provider = new EventHeaderDynamicProvider("MyCompany_MyOrg_MyComponent")` to
  create a provider that will manage tracepoints for your component.

- For best behavior, call `provider.Register(level, keyword)` for each
  level/keyword combination that will be used by your component.

  - Registering all necessary combinations at startup rather than on-first-use
    helps event consumers see which level/keyword combinations might be generated by
    your component, making it easier for them to collect all of the combinations they
    need to collect.

  - You might want to cache the tracepoints returned by `Register` if you want to
    avoid the overhead of looking them up later.

- When you need to generate an event with a particular level/keyword combination:

  - Use `tracepoint = provider.FindOrRegister(level, keyword)` to access the
    tracepoint for the event (or use `provider.Find(...)` if you know that the tracepoint
    has already been registered, or use a cached value if you cached the tracepoint
    returned by `provider.Register(...)`).

  - Check `tracepoint.IsEnabled` to determine whether any consumer is collecting the
    tracepoint's data. If it returns false, there is no need to write the event so you can
    skip the remaining steps.

  - Create a `builder = new EventHeaderDynamicBuilder()` for building the event (or use a
    previously-allocated builder to minimize overhead/garbage).

  - Call `builder.Reset("MyEventName")` to start building your event.

  - Call builder methods as appropriate to add fields to the event or to configure event
    attributes like tag, opcode, id, or version.

  - Call `builder.Write(tracepoint)` to write the builder's event to the tracepoint.

  - Call `builder.Dispose()` to return the builder's temporary buffers to the array pool.

- At component cleanup, call `provider.Dispose()` to unregister all tracepoints.

## Changelog

### 0.1.3 (TBD)

- Initial release.
